sudo unshare -i -m -n -p -u -U --mount-proc -f sh
exit
mkdir rootfs

docker run busybox
sergiymatveev@cloudshell:~/t3demo$ docker ps -a 
CONTAINER ID   IMAGE     COMMAND   CREATED          STATUS                      PORTS     NAMES
7ad75b69721e   busybox   "sh"      48 seconds ago   Exited (0) 47 seconds ago             jovial_moser
docker export 7ad75b69721e | tar -xf - -C rootfs
sergiymatveev@cloudshell:~/t3demo$ ls -al rootfs/
total 60
drwxr-xr-x 13 sergiymatveev sergiymatveev  4096 Jun  3 16:39 .
drwxr-xr-x  3 sergiymatveev sergiymatveev  4096 Jun  3 16:35 ..
-rwxr-xr-x  1 sergiymatveev sergiymatveev     0 Jun  3 16:37 .dockerenv
drwxr-xr-x  2 sergiymatveev sergiymatveev 12288 May 19 16:30 bin
drwxr-xr-x  4 sergiymatveev sergiymatveev  4096 Jun  3 16:37 dev
drwxr-xr-x  3 sergiymatveev sergiymatveev  4096 Jun  3 16:37 etc
drwxr-xr-x  2 sergiymatveev sergiymatveev  4096 May 19 16:30 home
drwxr-xr-x  2 sergiymatveev sergiymatveev  4096 May 19 16:30 lib
lrwxrwxrwx  1 sergiymatveev sergiymatveev     3 May 19 16:30 lib64 -> lib
drwxr-xr-x  2 sergiymatveev sergiymatveev  4096 Jun  3 16:37 proc
drwx------  2 sergiymatveev sergiymatveev  4096 May 19 16:30 root
drwxr-xr-x  2 sergiymatveev sergiymatveev  4096 Jun  3 16:37 sys
drwxr-xr-x  2 sergiymatveev sergiymatveev  4096 May 19 16:30 tmp
drwxr-xr-x  4 sergiymatveev sergiymatveev  4096 May 19 16:30 usr
drwxr-xr-x  4 sergiymatveev sergiymatveev  4096 May 19 16:30 var

sudo unshare -i -m -n -p -u -U --mount-proc -R rootfs -f sh
ip a
ls -al /
exit

sergiymatveev@cloudshell:~/t3demo$ runc spec
sergiymatveev@cloudshell:~/t3demo$ ls
               config.json  rootfs

sudo runc run t3demo

add to config.json
"args": [
			"sh", "-c", "while true; do {echo -e 'HTTP/1.1 200 OK\n\n Version 1.0.0'; | nc -vlp 8080; done"

"process": {
		"terminal": false
sudo runc run t3demo


another terminal - sudo runc ps t3demo / after sudo runc kill t3demo KILL

add to config.json 
     "namespaces": [
			
			{
				"type": "network",
                "path": "/var/run/netns/runc"

sudo ip netns add runc
for check 

sudo runc run t3demo ??
another terminal - sudo runc kill t3demo KILL

sudo brctl addbr runc0
sudo ip link set runc0 up
sudo ip addr add 192.168.1.1/24 dev runc0

sudo ip link add name veth-host type veth peer name veth-guest
sudo ip link set veth-host up

sudo brctl addif runc0 veth-host    
sudo ip link set veth-guest netns runc
sudo ip netns exec runc ip link set veth-guest name eth1
sudo ip netns exec runc ip addr add 192.168.1.2/24 dev eth1
sudo ip netns exec runc ip link set eth1 up 
sudo ip netns exec runc ip route add default via 192.168.0.1

sudo runc run t3demo

anothert terminal - culr 192.168.1.2:8080


View the recording at:

    https://asciinema.org/a/8J7kDfGlLXTfNWytw8Ldu7sRa

This installation of asciinema recorder hasn't been linked to any asciinema.org
account. All unclaimed recordings (from unknown installations like this one)
are automatically archived 7 days after upload.

If you want to preserve all recordings made on this machine, connect this
installation with asciinema.org account by opening the following link:

    https://asciinema.org/connect/5ea44f32-46c8-4d01-b742-a0badbb10461

-----------------------------------------------------------------------------------

docker tag e0172ee6e1a4 gcr.io/k8-3s/t3demo:v1.0.0
docker push gcr.io/k8-3s/t3demo:v1.0.0
gcloud auth login

947983e4b14b
docker tag 947983e4b14b gcr.io/k8-3s-388721/t3demo:v1.0.0
docker push gcr.io/k8-3s-388721/t3demo:v1.0.0
gcloud auth login
gcloud config set project k8-3s-388721
gcloud auth configure-docker

in IDE search command palete minikube then start
smatvyeyev ➜ /workspaces/t3 (main) $ docker ps
CONTAINER ID   IMAGE                                 COMMAND                  CREATED         STATUS         PORTS                                                                                                                                  NAMES
6103cc4668ca   gcr.io/k8s-minikube/kicbase:v0.0.39   "/usr/local/bin/entr…"   8 minutes ago   Up 8 minutes   127.0.0.1:32772->22/tcp, 127.0.0.1:32771->2376/tcp, 127.0.0.1:32770->5000/tcp, 127.0.0.1:32769->8443/tcp, 127.0.0.1:32768->32443/tcp   minikube
kubectl get pods -A
@smatvyeyev ➜ /workspaces/t3 (main) $ kubectl get pods -A
NAMESPACE     NAME                               READY   STATUS    RESTARTS      AGE
kube-system   coredns-787d4945fb-dnknk           1/1     Running   0             10m
kube-system   etcd-minikube                      1/1     Running   0             11m
kube-system   kube-apiserver-minikube            1/1     Running   0             11m
kube-system   kube-controller-manager-minikube   1/1     Running   0             11m
kube-system   kube-proxy-5cqlx                   1/1     Running   0             10m
kube-system   kube-scheduler-minikube            1/1     Running   0             11m
kube-system   storage-provisioner                1/1     Running   1 (10m ago)   11m

@smatvyeyev ➜ /workspaces/t3 (main) $ minikube status
minikube
type: Control Plane
host: Running
kubelet: Running
apiserver: Running
kubeconfig: Configured

kubectl config current-context

@smatvyeyev ➜ /workspaces/t3 (main) $ kubectl version
WARNING: This version information is deprecated and will be replaced with the output from kubectl version --short.  Use --output=yaml|json to get the full version.
Client Version: version.Info{Major:"1", Minor:"26", GitVersion:"v1.26.4", GitCommit:"f89670c3aa4059d6999cb42e23ccb4f0b9a03979", GitTreeState:"clean", BuildDate:"2023-04-12T12:13:53Z", GoVersion:"go1.19.8", Compiler:"gc", Platform:"linux/amd64"}
Kustomize Version: v4.5.7
Server Version: version.Info{Major:"1", Minor:"26", GitVersion:"v1.26.3", GitCommit:"9e644106593f3f4aa98f8a84b23db5fa378900bd", GitTreeState:"clean", BuildDate:"2023-03-15T13:33:12Z", GoVersion:"go1.19.7", Compiler:"gc", Platform:"linux/amd64"}


@smatvyeyev ➜ /workspaces/t3 (main) $ kubectl version
WARNING: This version information is deprecated and will be replaced with the output from kubectl version --short.  Use --output=yaml|json to get the full version.
Client Version: version.Info{Major:"1", Minor:"26", GitVersion:"v1.26.4", GitCommit:"f89670c3aa4059d6999cb42e23ccb4f0b9a03979", GitTreeState:"clean", BuildDate:"2023-04-12T12:13:53Z", GoVersion:"go1.19.8", Compiler:"gc", Platform:"linux/amd64"}
Kustomize Version: v4.5.7
Server Version: version.Info{Major:"1", Minor:"26", GitVersion:"v1.26.3", GitCommit:"9e644106593f3f4aa98f8a84b23db5fa378900bd", GitTreeState:"clean", BuildDate:"2023-03-15T13:33:12Z", GoVersion:"go1.19.7", Compiler:"gc", Platform:"linux/amd64"}
-----------------
@smatvyeyev ➜ /workspaces/t3 (main) $ kubectl get all -A
NAMESPACE     NAME                                   READY   STATUS    RESTARTS      AGE
kube-system   pod/coredns-787d4945fb-dnknk           1/1     Running   0             24m
kube-system   pod/etcd-minikube                      1/1     Running   0             24m
kube-system   pod/kube-apiserver-minikube            1/1     Running   0             24m
kube-system   pod/kube-controller-manager-minikube   1/1     Running   0             24m
kube-system   pod/kube-proxy-5cqlx                   1/1     Running   0             24m
kube-system   pod/kube-scheduler-minikube            1/1     Running   0             24m
kube-system   pod/storage-provisioner                1/1     Running   1 (23m ago)   24m

NAMESPACE     NAME                 TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)                  AGE
default       service/kubernetes   ClusterIP   10.96.0.1    <none>        443/TCP                  24m
kube-system   service/kube-dns     ClusterIP   10.96.0.10   <none>        53/UDP,53/TCP,9153/TCP   24m

NAMESPACE     NAME                        DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR            AGE
kube-system   daemonset.apps/kube-proxy   1         1         1       1            1           kubernetes.io/os=linux   24m

NAMESPACE     NAME                      READY   UP-TO-DATE   AVAILABLE   AGE
kube-system   deployment.apps/coredns   1/1     1            1           24m

NAMESPACE     NAME                                 DESIRED   CURRENT   READY   AGE
kube-system   replicaset.apps/coredns-787d4945fb   1         1         1       24m
--------------------------


kubectl create deployment t3demo --image=gcr.io/k8-3s-388721/t3demo:v1.0.0
kubectl get deploy -o wide
@smatvyeyev ➜ /workspaces/t3 (main) $ kubectl get deploy -o wide
NAME     READY   UP-TO-DATE   AVAILABLE   AGE   CONTAINERS   IMAGES                              SELECTOR
t3demo   0/1     1            0           57s   t3demo       gcr.io/k8-3s-388721/t3demo:v1.0.0   app=t3demo
@smatvyeyev ➜ /workspaces/t3 (main) $ kubectl get po
NAME                      READY   STATUS             RESTARTS   AGE
t3demo-86d54445f8-ck579   0/1     ImagePullBackOff   0          78s
@smatvyeyev ➜ /workspaces/t3 (main) $ 


---------------------------------
@smatvyeyev ➜ /workspaces/t3 (main) $ kubectl describe pod/t3demo-86d54445f8-tnqmm
Name:             t3demo-86d54445f8-tnqmm
Namespace:        default
Priority:         0
Service Account:  default
Node:             minikube/192.168.49.2
Start Time:       Sun, 04 Jun 2023 11:30:41 +0000
Labels:           app=t3demo
                  pod-template-hash=86d54445f8
Annotations:      <none>
Status:           Pending
IP:               10.244.0.5
IPs:
  IP:           10.244.0.5
Controlled By:  ReplicaSet/t3demo-86d54445f8
Containers:
  t3demo:
    Container ID:   
    Image:          gcr.io/k8-3s-388721/t3demo:v1.0.0
    Image ID:       
    Port:           <none>
    Host Port:      <none>
    State:          Waiting
      Reason:       ImagePullBackOff
    Ready:          False
    Restart Count:  0
    Environment:    <none>
    Mounts:
      /var/run/secrets/kubernetes.io/serviceaccount from kube-api-access-4296c (ro)
Conditions:
  Type              Status
  Initialized       True 
  Ready             False 
  ContainersReady   False 
  PodScheduled      True 
Volumes:
  kube-api-access-4296c:
    Type:                    Projected (a volume that contains injected data from multiple sources)
    TokenExpirationSeconds:  3607
    ConfigMapName:           kube-root-ca.crt
    ConfigMapOptional:       <nil>
    DownwardAPI:             true
QoS Class:                   BestEffort
Node-Selectors:              <none>
Tolerations:                 node.kubernetes.io/not-ready:NoExecute op=Exists for 300s
                             node.kubernetes.io/unreachable:NoExecute op=Exists for 300s
Events:
  Type     Reason          Age                    From               Message
  ----     ------          ----                   ----               -------
  Normal   Scheduled       3m46s                  default-scheduler  Successfully assigned default/t3demo-86d54445f8-tnqmm to minikube
  Normal   SandboxChanged  3m41s (x2 over 3m43s)  kubelet            Pod sandbox changed, it will be killed and re-created.
  Normal   Pulling         3m3s (x3 over 3m45s)   kubelet            Pulling image "gcr.io/k8-3s-388721/t3demo:v1.0.0"
  Warning  Failed          3m2s (x3 over 3m44s)   kubelet            Failed to pull image "gcr.io/k8-3s-388721/t3demo:v1.0.0": rpc error: code = Unknown desc = Error response from daemon: unauthorized: You don't have the needed permissions to perform this operation, and you may have invalid credentials. To authenticate your request, follow the steps in: https://cloud.google.com/container-registry/docs/advanced-authentication
  Warning  Failed          3m2s (x3 over 3m44s)   kubelet            Error: ErrImagePull
  Normal   BackOff         2m37s (x7 over 3m42s)  kubelet            Back-off pulling image "gcr.io/k8-3s-388721/t3demo:v1.0.0"
  Warning  Failed          2m37s (x7 over 3m42s)  kubelet            Error: ImagePullBackOff
@smatvyeyev ➜ /workspaces/t3 (main) $ 
----------------------------------------
kubectl describe pod/t3demo-86d54445f8-tnqmm

https://stackoverflow.com/questions/70728223/can-not-pull-any-image-in-minikube
minikube image load gcr.io/k8-3s-388721/t3demo:v1.0.0 NB!!!!

minikube delete --all

@smatvyeyev ➜ /workspaces/t3 (main) $ kubectl logs deploy/t3demo 
listening on [::]:8080 ...
kubectl exec -it deploy/t3demo -- sh

kubectl expose deployment hello-minikube --type=NodePort --port=8080

kubectl expose deploy/t3demo --port 80 --target-port 8080
@smatvyeyev ➜ /workspaces/t3 (main) $ kubectl get svc
NAME         TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)   AGE
kubernetes   ClusterIP   10.96.0.1      <none>        443/TCP   21m
t3demo       ClusterIP   10.103.1.228   <none>        80/TCP    38s

@smatvyeyev ➜ /workspaces/t3 (main) $ kubectl get ep
NAME         ENDPOINTS           AGE
kubernetes   192.168.49.2:8443   22m
t3demo       10.244.0.6:8080     97s

kubectl port-forward svc/t3demo 8088:80&

@smatvyeyev ➜ /workspaces/t3 (main) $ kubectl port-forward svc/t3demo 8088:80&
[1] 52786
@smatvyeyev ➜ /workspaces/t3 (main) $ Forwarding from 127.0.0.1:8088 -> 8080
Forwarding from [::1]:8088 -> 8080
Handling connection for 8088

@smatvyeyev ➜ /workspaces/t3 (main) $ curl 127.0.0.1:8088
Handling connection for 8088
 Version 1.0.0

@smatvyeyev ➜ /workspaces/t3 (main) $ kubectl logs deploy/t3demo 
listening on [::]:8080 ...
connect to [::ffff:127.0.0.1]:8080 from localhost:55298 ([::ffff:127.0.0.1]:55298)
GET /?vscodeBrowserReqId=1685879736154 HTTP/1.1
Host: 127.0.0.1:8088
Connection: keep-alive
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 13_4_0) AppleWebKit/537.36 (KHTML, like Gecko) Code/1.78.2 Chrome/108.0.5359.215 Electron/22.5.2 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Sec-Fetch-Site: cross-site
Sec-Fetch-Mode: navigate
Sec-Fetch-Dest: iframe
Accept-Encoding: gzip, deflate, br
Accept-Language: en-GB

listening on [::]:8080 ...
connect to [::ffff:127.0.0.1]:8080 from localhost:47206 ([::ffff:127.0.0.1]:47206)
GET / HTTP/1.1
Host: 127.0.0.1:8088
User-Agent: curl/7.68.0
Accept: */*

listening on [::]:8080 ...
connect to [::ffff:127.0.0.1]:8080 from localhost:47262 ([::ffff:127.0.0.1]:47262)
GET /?vscodeBrowserReqId=1685879858661 HTTP/1.1
Host: 127.0.0.1:8088
Connection: keep-alive
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 13_4_0) AppleWebKit/537.36 (KHTML, like Gecko) Code/1.78.2 Chrome/108.0.5359.215 Electron/22.5.2 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Sec-Fetch-Site: cross-site
Sec-Fetch-Mode: navigate
Sec-Fetch-Dest: iframe
Accept-Encoding: gzip, deflate, br
Accept-Language: en-GB

listening on [::]:8080 ...
connect to [::ffff:127.0.0.1]:8080 from localhost:41162 ([::ffff:127.0.0.1]:41162)
GET /?vscodeBrowserReqId=1685879861795 HTTP/1.1
Host: 127.0.0.1:8088
Connection: keep-alive
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 13_4_0) AppleWebKit/537.36 (KHTML, like Gecko) Code/1.78.2 Chrome/108.0.5359.215 Electron/22.5.2 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Sec-Fetch-Site: cross-site
Sec-Fetch-Mode: navigate
Sec-Fetch-Dest: iframe
Accept-Encoding: gzip, deflate, br
Accept-Language: en-GB

listening on [::]:8080 ...
connect to [::ffff:127.0.0.1]:8080 from localhost:41174 ([::ffff:127.0.0.1]:41174)
GET /?vscodeBrowserReqId=1685879863027 HTTP/1.1
Host: 127.0.0.1:8088
Connection: keep-alive
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 13_4_0) AppleWebKit/537.36 (KHTML, like Gecko) Code/1.78.2 Chrome/108.0.5359.215 Electron/22.5.2 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Sec-Fetch-Site: cross-site
Sec-Fetch-Mode: navigate
Sec-Fetch-Dest: iframe
Accept-Encoding: gzip, deflate, br
Accept-Language: en-GB

listening on [::]:8080 ...
connect to [::ffff:127.0.0.1]:8080 from localhost:37970 ([::ffff:127.0.0.1]:37970)
GET /?vscodeBrowserReqId=1685879876811 HTTP/1.1
Host: 127.0.0.1:8088
Connection: keep-alive
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 13_4_0) AppleWebKit/537.36 (KHTML, like Gecko) Code/1.78.2 Chrome/108.0.5359.215 Electron/22.5.2 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Sec-Fetch-Site: cross-site
Sec-Fetch-Mode: navigate
Sec-Fetch-Dest: iframe
Accept-Encoding: gzip, deflate, br
Accept-Language: en-GB

listening on [::]:8080 ...
-------------------------------
wget https://github.com/wagoodman/dive/releases/download/v0.9.2/dive_0.9.2_linux_amd64.deb
sudo apt install ./dive_0.9.2_linux_amd64.deb

dive --ci --lowestEfficiency=0.9 947983e4b14b
dive --ci --lowestEfficiency=0.9 gcr.io/k8-3s-388721/t3demo:v1.0.0

https://asciinema.org/~smatvyeyev
asciinema rec
When you're ready to finish simply exit the shell either by typing exit or hitting Ctrl-D.