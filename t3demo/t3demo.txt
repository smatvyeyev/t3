sudo unshare -i -m -n -p -u -U --mount-proc -f sh
exit
mkdir rootfs

docker run busybox
sergiymatveev@cloudshell:~/t3demo$ docker ps -a 
CONTAINER ID   IMAGE     COMMAND   CREATED          STATUS                      PORTS     NAMES
7ad75b69721e   busybox   "sh"      48 seconds ago   Exited (0) 47 seconds ago             jovial_moser
docker export 7ad75b69721e | tar -xf - -C rootfs
sergiymatveev@cloudshell:~/t3demo$ ls -al rootfs/
total 60
drwxr-xr-x 13 sergiymatveev sergiymatveev  4096 Jun  3 16:39 .
drwxr-xr-x  3 sergiymatveev sergiymatveev  4096 Jun  3 16:35 ..
-rwxr-xr-x  1 sergiymatveev sergiymatveev     0 Jun  3 16:37 .dockerenv
drwxr-xr-x  2 sergiymatveev sergiymatveev 12288 May 19 16:30 bin
drwxr-xr-x  4 sergiymatveev sergiymatveev  4096 Jun  3 16:37 dev
drwxr-xr-x  3 sergiymatveev sergiymatveev  4096 Jun  3 16:37 etc
drwxr-xr-x  2 sergiymatveev sergiymatveev  4096 May 19 16:30 home
drwxr-xr-x  2 sergiymatveev sergiymatveev  4096 May 19 16:30 lib
lrwxrwxrwx  1 sergiymatveev sergiymatveev     3 May 19 16:30 lib64 -> lib
drwxr-xr-x  2 sergiymatveev sergiymatveev  4096 Jun  3 16:37 proc
drwx------  2 sergiymatveev sergiymatveev  4096 May 19 16:30 root
drwxr-xr-x  2 sergiymatveev sergiymatveev  4096 Jun  3 16:37 sys
drwxr-xr-x  2 sergiymatveev sergiymatveev  4096 May 19 16:30 tmp
drwxr-xr-x  4 sergiymatveev sergiymatveev  4096 May 19 16:30 usr
drwxr-xr-x  4 sergiymatveev sergiymatveev  4096 May 19 16:30 var

sudo unshare -i -m -n -p -u -U --mount-proc -R rootfs -f sh
ip a
ls -al /
exit

sergiymatveev@cloudshell:~/t3demo$ runc spec
sergiymatveev@cloudshell:~/t3demo$ ls
               config.json  rootfs

sudo runc run t3demo

add to config.json
"args": [
			"sh", "-c", "while true; do {echo -e 'HTTP/1.1 200 OK\n\n Version 1.0.0'; | nc -vlp 8080; done"

"process": {
		"terminal": false
sudo runc run t3demo


another terminal - sudo runc ps t3demo / after sudo runc kill t3demo KILL

add to config.json 
     "namespaces": [
			
			{
				"type": "network",
                "path": "/var/run/netns/runc"

sudo ip netns add runc
for check 

sudo runc run t3demo ??
another terminal - sudo runc kill t3demo KILL

sudo brctl addbr runc0
sudo ip link set runc0 up
sudo ip addr add 192.168.1.1/24 dev runc0

sudo ip link add name veth-host type veth peer name veth-guest
sudo ip link set veth-host up

sudo brctl addif runc0 veth-host    
sudo ip link set veth-guest netns runc
sudo ip netns exec runc ip link set veth-guest name eth1
sudo ip netns exec runc ip addr add 192.168.1.2/24 dev eth1
sudo ip netns exec runc ip link set eth1 up 
sudo ip netns exec runc ip route add default via 192.168.0.1

sudo runc run t3demo

anothert terminal - culr 192.168.1.2:8080


View the recording at:

    https://asciinema.org/a/8J7kDfGlLXTfNWytw8Ldu7sRa

This installation of asciinema recorder hasn't been linked to any asciinema.org
account. All unclaimed recordings (from unknown installations like this one)
are automatically archived 7 days after upload.

If you want to preserve all recordings made on this machine, connect this
installation with asciinema.org account by opening the following link:

    https://asciinema.org/connect/5ea44f32-46c8-4d01-b742-a0badbb10461

-----------------------------------------------------------------------------------

docker tag e0172ee6e1a4 gcr.io/k8-3s/t3demo:v1.0.0
docker push gcr.io/k8-3s/t3demo:v1.0.0
gcloud auth login